# SPDX-License-Identifier: GPL-2.0-only
#
# Copyright (c) 2025 sevenlab engineering GmbH
#
# This rule is based on systemd/rules.d/60-serial.rules
#
# GPIO devices do not expose a port number, so we're omitting that. Not sure if
# this will make the device id clash if multiple devices of the same type are
# present.

ACTION=="remove", GOTO="gpiochip_end"
SUBSYSTEM!="gpio", GOTO="gpiochip_end"

SUBSYSTEMS=="usb", IMPORT{builtin}="usb_id", IMPORT{builtin}="hwdb --subsystem=usb"

KERNEL!="gpiochip[0-9]*", GOTO="gpiochip_end"

IMPORT{builtin}="path_id"
ENV{ID_PATH}=="?*",                   SYMLINK+="gpio/by-path/$env{ID_PATH}"
ENV{ID_PATH_WITH_USB_REVISION}=="?*", SYMLINK+="gpio/by-path/$env{ID_PATH_WITH_USB_REVISION}"

ENV{ID_BUS}=="", GOTO="gpiochip_end"
ENV{ID_SERIAL}=="", GOTO="gpiochip_end"
ENV{ID_USB_INTERFACE_NUM}=="", GOTO="gpiochip_end"
SYMLINK+="gpio/by-id/$env{ID_BUS}-$env{ID_SERIAL}-if$env{ID_USB_INTERFACE_NUM}"

LABEL="gpiochip_end"
